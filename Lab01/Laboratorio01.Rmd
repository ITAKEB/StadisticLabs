---
title: "Laboratorio 01"
output:
  html_document:
    df_print: paged
  pdf_document: default
date: "2023-02-08"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Bloque 0

### Problema 1

```{r, p1}
  x = c(1,2,3,4)
  y = seq(1:10)
  z = seq(2,10,2)
  w = rep(0,10)
  y[3] = 1
```

### Problema 2
```{r, p2}
  curve(x+1, from=1, to=10 ,xlab="x", ylab="y")
  curve((x^2)+1, from=1, to=10, xlab="x", ylab="y")
  curve(sin(x), from=1, to=10, xlab="x", ylab="y")
  curve(cos(x), from=1, to=10, xlab="x", ylab="y")
  curve(log(x), from=1, to=10, xlab="x", ylab="y")
```


### Problema 3
```{r,p3}
  curve(x+1, from=1, to=10 ,xlab="x", ylab="y")
  curve((x^2)+1, from=1, to=10, xlab="x", ylab="y")
  curve(sin(x), from=1, to=10, xlab="x", ylab="y")
  curve(cos(x), from=1, to=10, xlab="x", ylab="y")
  curve(log(x), from=1, to=10, xlab="x", ylab="y")
```


### Problema 4
```{r, p4}
library(readr)
dat = read_csv("./pizzadelivery.csv")
  #str(dat)
  #dim(dat)
  #colnames(dat)
  #names(dat)
  #nrow(dat)
  #ncol(dat)
  #head(dat)
  #tail(dat)
  #dat["temperature"] = (dat["temperature"] * (9/5)) + 32
  dat[dat$driver == 'Domenico',]
  dat[dat$pizzas >= 4,"day"]
```

## Bloque 1

### Problema 5
- day : cualitativa-discreta
- date : cualitativa-ordinal
- time : cuantitativa-discreta
- operator : cualitativa-nominal
- branch : cualitativa - ? 
- driver : cualitativa-nominal
- temperature : cuantitativa-continua
- bill : cuantitativa-discreta
- pizzas : cuantitativa-discreta
- free_wine : cualitativa-nominal
- got_wine : cualitativa-nominal
- discount_customer : cualitativa- ?

### Problema 6

```{r p6}
  fi = table(dat$driver)
  hi = fi/length(dat$driver)
  barplot(fi)
  tabla = cbind(fi,hi)
```
### Problema 7

```{r}
table(dat[dat$free_wine==TRUE,7])
```

### Problema 8

```{r}
table(dat[dat$free_wine==T & dat$got_wine==T,6])
```


## Bloque 2

### Problema 9

#### Temperature
Como podemos observar en la siguiente tabla de frecuencia, la temperatura más habitual con la que se entrega la pizza varía en un rango dentro de (145,152] y (137,145], siendo el primero el más común. Además, la temperatura menos habitual se encuentra en un rango de (190,197], siendo solo 1 pizza la que se entregó con esta temperatura. Cabe recalcar que esta tabla de frecuencia se hizo con una número de clase igual a 5 para su análisis.

```{r}
    # Temperature
    # library(readr)
    # db = read_csv("./pizzadelivery.csv")
    # Variable: Time
    temp_list = dat$temperature

    # Calculate information to create frequency table
    min = min(temp_list)
    max = max(temp_list)
    length = length(temp_list)
    range = max - min
    class_num = round(1 + log(length, 2))
    class_width = round(range / class_num, 2)
    
    print(c("Min", min))
    print(c("Max", max))
    print(c("Length", length))
    print(c("Range", range))
    print(c("Class Number", class_num))
    print(c("Class Width", class_width))
    
    #Calculate intervals and midpoints 
    sequ = seq(min, max + class_width, class_width)
    intervals = cut(temp_list, sequ, right = TRUE, include.lowest = TRUE)
    abs_freq = table(intervals)
    midpoints = round((head(sequ, -1) + diff(sequ) / 2), 2)
    
    #Generate frequency table
    freq_table = cbind(
        Mark = midpoints,
        Abs = abs_freq, 
        Reltv = round(abs_freq / length(temp_list), 2), 
        Acm = cumsum(abs_freq),
        ReAcm = round(cumsum(abs_freq) / length(temp_list))
    )
    
    print(freq_table)
```
#### Time
Por medio del siguiente gráfico, podemos notar como el tiempo más usual de una entrega se tarde entre 28.6 y 36.8 minutos, puesto que el 45% de las pizzas son entregadas en este periodo de tiempo. Por otro lado, lo menos habitual es que una pizza sea entregada en un periodo de 12.3 y 20.5 minutos, ya que solo el 2.21% de las pizzas son entregadas durante este.

```{r}
  #time
  min = min(dat$time)
  max = max(dat$time)
  k = 5
  A = (max-min)/ k
  
  intervals = cut(dat$time, breaks=seq(min, max, by = A), Right = TRUE, include.lowest=TRUE)
  
  fi = table(intervals)
  porc = (fi/ length(dat$time))*100 
  porc = round(porc,2)
  
  pie(porc, porc, col = 2:7, main= "Time")
  legend("topleft",legend=names(fi), fill=2:7)
  
```
#### Bill
Para el caso de la variable Bill (cuenta), realizamos el análisis de frecuencia mediante el siguiente histograma, describiendo el siguiente comportamiento:
 - Entre [35, 40) y [45,50) tienen una frecuencia absoluta mayor o igual a 200
 - Entre [0, 10) tienen una frecuencia absoluta de 1

```{r}
  # bill
  fi = hist(dat$bill, xlab= "Bill", ylab = "Frequency", main= "Histogram of bill", col = 2:3)

  # fi$counts
  
```
#### Pizzas
Para finalizar, en el caso de la variable "pizzas", nos encontramos con que la cantidad pedida con mayor frecuencia va de un rango de 2 a 3 pizzas por orden. A su vez, podemos ver en la siguiente ilustración como el numero de 8, 9 y 11 pizzas son las cantidades más inusuales en la tienda.

```{r}
  fi = table(dat$pizzas)
  hi  = fi/length(dat$pizzas)
  porc = (fi/ length(dat$pizzas))*100 
  barplot(fi, col=3:4)
```

### Problema 10

La central que ha llegado a valores altos de temperatura es la sede East. Estando en el intervalo de (81.8, 91.8]. Por otro lado, la temperatura
con mayor aparicion en las sedes se encuentran en el intervalo de (61.8, 71.8], seguido por el intervalo (51.8, 61.8].

```{r}
    get_intervals <- function(sublist) {
	min = min(sublist)
    	max = max(sublist)
    	sequ = seq(min, max + 10, 10)
    	intervals = cut(sublist, sequ, right = TRUE, include.lowest = TRUE)

	return (intervals)
    }

    intervals = get_intervals(temp_list)
    table = table(intervals, dat$branch)
    par(mar = c(5.1, 4.1, 4.1, 8.1), xpd = TRUE)
    barplot(table, beside = T, col = rainbow(5), main = "Temperature for branch °C", legend.text = TRUE,
	    args.legend = list(x = "topright", inset = c(-0.3, 0)))
```

### Problema 11

Se han entregado mas pizzas los fines de semana (Viernes, Sabado y Domingo) que en el resto de la semana.

```{r}
    dat$weekend = ifelse(dat$day == 'Friday' | dat$day == 'Saturday' | dat$day == 'Sunday', 1, 0)
    
    weekend_pizzas = sum(dat[dat$weekend == 1, 10])
    weekday_pizzas = sum(dat[dat$weekend == 0, 10])
    
    par(mar = c(5.1, 4.1, 4.1, 10), xpd = TRUE)
    barplot(c(weekday_pizzas, weekend_pizzas), main = "# Pizzas", col = 1:2)
    legend(3, 2000, legend=c("Weekday", "Weekend"),
           col = 1:2, cex=0.8, inset = c(-0.3, 0), fill = 1:2)
```

Se ha conseguido mayor ganancia los fines de semana (Viernes, Sabado y Domingo) que en el resto de la semana. Era de esperarse debido a que
existe mayor demanda de pizzas los fines de semana.

```{r}
    weekend_bill = sum(dat[dat$weekend == 1, 9])
    weekday_bill = sum(dat[dat$weekend == 0, 9])
    
    par(mar = c(5.1, 4.1, 4.1, 10), xpd = TRUE)
    barplot(c(weekday_bill, weekend_bill), main = "Earnings", col = 1:2)
    legend(3, 25000, legend=c("Weekday", "Weekend"),
           col = 1:2, cex=0.8, inset = c(-0.3, 0), fill = 1:2)
```

## Bloque 3

## Problema 12

```{r}
    weekend_bill = sum(dat[dat$weekend == 1, 9])
    mode <- function(v) {
       uniqv <- unique(v)
       uniqv[which.max(tabulate(match(v, uniqv)))]
    }

    # Temperature 
    mean = mean(temp_list)
    median = median(temp_list)
    mode = mode(temp_list)
    min = min(temp_list)
    max = max(temp_list)
    desv = sd(temp_list)
    range = max - min
    quantiles = quantile(temp_list, c(0.25), type = 6)

    # Time
    time_list = dat$time
    mean = mean(time_list)
    median = median(time_list)
    mode = mode(time_list)
    min = min(time_list)
    max = max(time_list)
    desv = sd(time_list)
    range = max - min
    quantiles = quantile(temp_list, c(0.25), type = 6)
```

## Problema 13

Se puede observar en la siguiente tabla como la temperatura con la que es entregada las pizzas, varía considerablemente entre semana y fin de semana. Puesto en los días como viernes, sabado y domingo la mayoría de las pizzas son entregadas con una temperatura amena para el cliente. Variando entre 61.8 a 71.8 grados celcius, sin embargo también se entrega mayor cantidad de pizzas frías a comparación con los días de la semana. Esto posiblemente sea por la alta demanda de pizzas de la tienda en los fines de semana.

```{r} 
    # Temperature -> weekday - weekend
    #min= min(temp_list)
    #max = max(temp_list)
    #sequ = seq(min, max + 10, 10)
    #intervals = cut(temp_list, sequ, right = TRUE, include.lowest = TRUE)
    
    intervals = get_intervals(temp_list)
    table = table(intervals, dat$day)
    print(table)
    table = table(intervals, ifelse(dat$weekend == 1, "Weekend", "Weekday"))
    print(table)
```
En cuanto al tiempo de entrega, no se puede apreciar una gran diferencia entre los días seleccionados. El comportamiento es muy similar en ambos casos, variando la mayor cantidad de entregas entre 32.3 y 42.3 minutos.Por otro lado es inusual que se entreguen las pizzas en el intervalo 12.3 y 22.3, siendo estos los tiempos más pequeños de entrega que se han registrado. Además, cabe recalcar que para este caso de estudio realizamos un total de 4 intervalos.

El comportamiento mencionado lo podemos observar en la siguiente grafica.  
```{r} 
    # Time -> weekday - weekend
    #min= min(time_list)
    #max = max(time_list)
    #sequ = seq(min, max + 10, 10)
    #intervals = cut(time_list, sequ, right = TRUE, include.lowest = TRUE)

    intervals = get_intervals(time_list)
    table = table(intervals, dat$day)
    print(table)
    table = table(intervals, ifelse(dat$weekend == 1, "Weekend", "Weekday"))
    print(table)

    par(mar = c(5.1, 4.1, 4.1, 8.1), xpd = TRUE)
    barplot(table, beside = T, col = c("red","yellow","green","blue","black"), main = "Time for weekday and weekend", legend.text = TRUE,
	    args.legend = list(x = "topright", inset = c(-0.3, 0)))
```
Analizando los tiempos de entrega entre las diferentes sedes, hay una notable diferencia entre la sedes West, East y Centre. Ya que a pesar de que la sede East no es de las que más numero de pizzas vende, es la que más rapido las entrega, llegando al punto de entregar 41 pizzas en un intervalo de 12.3 y 22.3 minutos (algo inusual en las demás sedes). Por otro lado, la sede Centre tiene los peores tiempos de entrega comparado con sus hermanas, esto probablemente debido a su contante demanda de pizzas todos los días de la semana.

```{r} 
    # Time -> branch
    #min = min(time_list)
    #max = max(time_list)
    #sequ = seq(min, max + 10, 10)
    #intervals = cut(time_list, sequ, right = TRUE, include.lowest = TRUE)

    intervals = get_intervals(time_list)
    table = table(intervals, dat$branch)
    print(table)
```
Con respecto a la temperatura, la sede East tambien saca ventaja a las sedes Centre y West, ya que comparandola con las otras 2, la sede East usualmente entrega las pizzas con una temperatura entre 67.8 y 71.8 grados celcius.

Teniendo esta información y la de la tabla anterior (tiempo de entrega por sede), podemos decir que la sede East es la mejor sede de las 3, ya que además de entregar sus pizzas más rapido, las entrega más calientes.
```{r} 
    # Temperature -> branch
    #min = min(temp_list)
    #max = max(temp_list)
    #sequ = seq(min, max + 10, 10)
    #intervals = cut(temp_list, sequ, right = TRUE, include.lowest = TRUE)

    intervals = get_intervals(temp_list)
    table = table(intervals, dat$branch)
    print(table)
    par(mar = c(5.1, 4.1, 4.1, 8.1), xpd = TRUE)
    barplot(table, beside = T, col = c("red","yellow","green","blue","black"), main = "Temperature for branches", legend.text = TRUE,
	    args.legend = list(x = "topright", inset = c(-0.3, 0)))
```

## Problema 13

```{r} 
    #min = min(time_list)
    #max = max(time_list)
    #sequ = seq(min, max + 10, 10)
    #intervals = cut(time_list, sequ, right = TRUE, include.lowest = TRUE)

    intervals =  get_intervals(time_list)
    table = table(intervals, dat$driver)
    print(table)
```
